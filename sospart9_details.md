*start part-9*

*4:04:54
so we have now completed all the functionality that enables a user to add items to the user's shopping cart as well as remove items from the user's shopping cart a user is also able to update the quantity of products within the user's shopping cart so of course no point leaving the products hanging around in the user's shopping cart the next logical step is for a user to purchase the products in the user's shopping cart so we are going to create a razor component in this part of the course that denotes a checkout facility whereby the user can purchase the products within the user's shopping cart so how do we create a payment facility so that users can purchase the items in the user's shopping cart the answer is we must integrate a payment gateway into our application so if we navigate to this website we can see here some useful information regarding payment gateways what is a payment gateway*

*4:06:08
a payment gateway is a service that authorizes and processes debit slash credit card or paypal payments for online merchants and traditional brick and mortar businesses a payment gateway facilitates these transactions by encrypting sensitive data and transferring it between a payment portal a website or a mobile device and the bank slash front end processor if we scroll further down this page we can see a list of the most popular payment gateway providers you've probably heard of a few of them like for example paypal and stripe paypal stripe square secure pay worldpay authorized.net to checkout.com braintree i have a business account with paypal so i'm most familiar with paypal in this video i'll give you a very basic guide on how you can integrate the paypal payment gateway into your application even though i'm specifically using paypal the same fundamental principles will apply for other payment gateways please see the relevant instructions provided by your preferred payment gateway service provider on how you can integrate your preferred payment gateway into your applications the payment gateway service provider will provide developers with information on how to integrate the relevant payment*

*4:07:42
gateway into your application it's not as difficult as you might think all of the heavy lifting as it were is done through the third party payment gateway so this tutorial is not a definitive or comprehensive guide on how to integrate a payment gateway into your application but it will hopefully give you a very good idea of how to integrate a payment gateway into your applications it all depends on your application's requirement on how you go about implementing relevant payment gateway integration functionality in your applications let me first present a brief disclaimer before we start this tutorial this is not a definitive guide on integrating a payment gateway into your application this is certainly not a final e-commerce solution the purpose of this tutorial serves to give you a basic idea of how you are able to integrate a payment gateway into a blazer webassembly application if you wish to create an application that uses a payment gateway in a live environment you'll need to research relevant information provided by your preferred payment gateway provider in order to gain a thorough understanding*

*4:09:05
of how to create an e-commerce solution using the relevant payment gateway right let's get started let's create a razor component named checkout.razer within the pages folder let's create a c-sharp class named checkoutbase.cs within the pages folder let's write code to ensure that the checkout razer component inherits from the checkout base class as the name of our razer component suggests a user will navigate to this razor component in order to purchase the items within the user's shopping cart paypal makes it easy for us to integrate the payment gateway functionality within our applications by providing us with sample html and javascript code in order to copy the relevant html and javascript code let's navigate to this paypal web page if we scroll further down the page paypal presents us with a few options i'm going to use the first option here let's click the start setup button let's select the variable price list item here 
let's select the desktop option here then to copy the relevant javascript and html code we can click the copy code button here let's navigate to our index.html page and paste the html and javascript code currently stored within our clipboards here you can see here we have a javascript function named init paypal button this method contains callback methods like for example create order and on approved the create order method is called by paypal when an order is created and the on approved method is called after the relevant order has been approved by paypal*

*4:11:44
note that within the on approved method there is code that logs information about the order which is sent back from paypal after an order has been approved 
to the browser console window the relevant information is sent back from paypal regarding the relevant order after the order has been approved by paypal so this gives us an idea of how our code integrates with paypal we also have a script tag here that references a script file at a specific paypal location the way in which we are able to link a paypal account to our application is through this client dash id parameter here at the moment we only have a placeholder value for the client dash id parameter i'll demonstrate a bit later how we are able to generate a valid client id value that we can paste over this placeholder value here i'll demonstrate this a bit later we have this html code here that contains various fields and a placeholder for the relevant payment gateway related buttons that the user can use to start the payment process the user will be able to pay using a valid debit or credit card by clicking this button or if the user has a valid paypal account the user can use the user's paypal account by clicking this button for a particular integration requirement*

*4:13:13
we can tailor the sample code to our needs so we are going to simplify the code here and remove code that is superfluous in relation to our particular requirement so let's say that for a particular integration requirement we only need the description field and the amount field so we can delete the javascript code from the init paypal button method here that references the html elements denoting the fields that we don't need we don't need this code here so let's delete it we don't need this code because it is code used for validating user input code within our application will control what is entered into the appropriate fields namely the amount field and the description field therefore we don't need any user validation related code in the on init method there is a lot of code relevant to user validation that we don't need let's delete the honornet method within the onclick method we only need this code here that references the values that will be inserted into the amount and description fields at an appropriate time by certain code within our application so let's copy the relevant code from the onclick method here let's paste it into the create order method here then we can simply delete the onclick method you can see here in the on approved method we have code here that logs order information to the user's browser console window this information is sent back from paypal once a user's order has*

*4:15:09
been approved by paypal and contains details about the user's order we'll examine the order information later when we test our code you can see here that the sample code that we copied from paypal includes a call to the init paypal button javascript method we want to control when the init paypal button method is invoked we'll implement the code to call the init paypal button method using c-sharp code and blaze's javascript interoperability feature from within the checkout razer component in a bit so let's remove the call to the init paypal button from the index.html file let's cut this html code here and paste it into our checkout.razer file his will allow the paypal buttons to be available to the user when the user invokes the checkout raiser component for our particular requirement let's say that all we are interested in is the description field and the amount field so let's remove the html elements that we don't need for the implementation of our integration code with paypal*

*4:16:38
we don't need the html elements that label the relevant fields because we are going to make the amount field and description field hidden text fields we don't want the user to enter any payment information we are going to control the values that are inserted into these fields through c-sharp code that we'll implement in a bit we need this div element here because this tells paypal as it were where we want the relevant paypal gateway related buttons placed within our ui so for our requirement we don't want these fields to be visible to the user so let's make these fields hidden text fields so let's create the code for the checkout base.cs class we are going to want to call the init paypal button javascript method that resides within our index.html file from within the checkoutbase.cs class so we need to write code that ensures that an object of type rjsruntime is injected into our checkoutrazor component at runtime 
this is so that we can utilize blaze's javascript interoperability feature to call the init paypal button javascript method that we copied from the relevant paypal web page earlier we'll write the code to call this javascript method in a bit we need to reference the collection of shopping cart items so let's create a property of type i enumerable that is strongly typed with the cart item dto type let's create a property named total qty let's create a property named payment description let's create a property named payment amount let's create code to bind the paypal related hidden text fields we have implemented within the checkout.razer file to their counterpart properties by using blazers at bind syntax so this means that every time relevant property values change laser will automatically update their counterpart input fields i.e the input fields that contain the relevant at bind syntax in the checkout.racer file the payment description and payment amount properties will be bound to the input fields implemented within the checkout.racer file so this is one of the aspects involved in integrating our application with paypal we can communicate the total payment amount to paypal through the payment amount property and we can communicate whatever payment description we want by updating the payment description property the javascript within the init paypal button method references the fields that we have implemented using hidden text fields in the checkout.razer file i.e*

*4:20:08
the amount field and the description field the fields are bound to their counterpart properties within the checkout base class we can use this description field to uniquely identify a particular payment there are of course many different ways to implement this type of functionality i've chosen this way for the sake of the example in the interests of keeping the example simple i.e for teaching purposes when we run the code and create a test order once our order is approved by paypal we'll be able to inspect the data within our browser's console window which is the data sent back from paypal after our order has been approved we'll see that one of the fields contains our unique description value we want an object of type i shopping cart service to be injected into our checkout raiser component at run time so let's create a property of type i shopping cart service and ensure that it is decorated with the inject attribute let's override the uninitialized async method let's implement code to retrieve the user's shopping cart items we'll look at code in a later tutorial whereby we can use local storage functionality so that we don't have to make so many calls to the server*

*4:21:51
we can use local storage to improve performance but we'll write this code in a later tutorial so i'm writing code to create a new good here so that we can use this good value to uniquely identify a particular order let's assign the total payment amount to the payment amount property let's assign the total quantity to the total qty property let's create an identifier field so that we can uniquely identify a particular order as i said earlier i'm just doing this for the sake of this example it is up to the developer to modify the appropriate code so that it is adapted appropriately in relation to the developer's particular requirement so let's include an o for order followed by the user's id and then followed by the unique guide value within the payment description field 
let's override the on after render async method this method is called in response to the occurrence of a blazer lifecycle event that occurs after the relevant razer component is rendered we can use the first render argument passed to this method to ensure that our code within this method is only fired once after our razor component is first rendered so if first render is true we want code to execute that uses our js object to call the init paypal button javascript method so you can see how we are integrating our checkout razer component with the sample javascript code that we included within the index.html file this*

*4:23:58
is of course the sample code we copied from paypal so as to perform our integration with their payment gateway so the next step is to generate the client id whereby we can link our paypal account to our application so we need to do this through paypal note that you are able to follow along with the next part of this tutorial even if you just have a personal account with paypal you will however need a business account with paypal if you wish to go live with the paypal payment gateway functionality paypal provides a sandbox feature that we can use for development and testing purposes but as i said if you wish to go live you'll need a paypal business account for instructions on how to create a paypal business account please navigate to this url so assuming you have a paypal account as stated you are still able to follow along even if you just have a personal account and you don't have a business account let's log in to paypal then let's click the developer menu option here so that we can use the sandbox feature to implement the server side part of the integration functionality so that we can integrate the paypal payment gateway into our application you can then navigate to the dashboard like this you can see here you have two options one for sandbox and the other for live*

*4:26:03
we are going to use the sandbox facility if you want to go live with your paypal  payment gateway you would use the live facility as discussed you will need a paypal business account before you are able to go live with the paypal payment gateway so to create the server side functionality that we need in order to integrate the paypal payment gateway into our application click the create app button let's give the app a sensible name and then create the app like this we now have this client id generated for us and this is the key to how we can associate our client-side integration with our paypal account so let's copy this client id value to our clipboards let's remain logged into paypal and let's appropriately paste the relevant client id value to our index.html file here for the client-id parameter great while we are here let's remove the enable dash funding parameter here let's go back to paypal so for testing purposes paypal allows us to generate mock credit card details when we test our code we are going to use the generated mock credit card details to make a test payment we can generate mock credit card details by clicking the credit card generator menu option here and then i'm going to select the united kingdom as my country first and then to generate the mock credit*

*4:28:21
card details we can press the generate credit card button here so let's copy the relevant mock credit card details and save them somewhere so that we can access them a little bit later when we test our application before we test the code let's make sure that we can navigate from our shopping 
cart razor component to our checkout component so to do this let's appropriately update the code  within our shoppingcart.razer file then we must also ensure that we have an appropriate at page directive at the top of our checkout.racer file a user needs to be able to navigate directly to the checkout raiser component so we must include appropriate root template information following the add page directive and now we should be able to make a test payment through our application  let's run the code let's add some items to our shopping cart let's proceed to check out let's appropriately enter our mock credit card details along with some appropriate made up data regarding personal information like address and phone number excellent now if we press f12 within our chrome browsers we can see the data sent back from paypal in the on approved callback method defined within the init paypal button method we have code to log data sent back from paypal after an approved order has been made we could implement code that extracts the relevant data from the returned data from paypal and update our application's database in an appropriate way depending on our requirement that functionality is beyond the scope of this course but hopefully this gives you a good enough insight of how to integrate the paypal functionality into your application but please read the relevant developer related information provided by your preferred payment gateway service provider for information on how to create relevant integration functionality that best suits your requirement and you can see here our custom description value that we created earlier in code has been sent back from paypal along with the other order information which contains the user id value*

*4:32:02
and a guide value that our code generates for each order that is sent to paypal so let's finish the code for our checkout raiser component let's say that we want to display a summary of items that the user is purchasing on the checkout ui next to the paypal buttons so let's write the code for this please note this code can be copied from the relevant github repository i have included the location of the relevant github repository below in the description  let's test the code excellent*

*End part-9*
